!function(){!function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return o(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){window.__bd4tVersionOverride=6,window.__bd4tSubVersionOverride=0,window.__bd4tDisablePrivacyCookie=!0;var r=e("../../../tracking/utils/adobeDataLayerUtils"),o=e("../../../tracking/utils/storage").hasUsableLocalStorage,i=["digitalData","dxData","digital_data"];i.forEach(function(e){bd4t("on",e,function(){r.dataLayerPushCallback(e,["page","user","product","pageInfo","productInfo","userInfo","cart","transaction","upcomingflight"],{all:["flow","destinationURL","referringURL","timeStamp","items","baseFare","surcharges","ancillaryMap","paymentOptionsDetails","messages","pnrInfo","emailId","userName","firstName","lastName","personalDetail","contactDetails"],transaction:["itineraryParts"]})})}),o&&window.localStorage.getItem("bd4t.global.user.id")||window.bd4t("load","guid"),e("../../../../static/html/tracking/module/core/common/v7.6.0.js"),window.bd4t("on","config",function(e){e.globalUserId&&o&&window.localStorage.setItem("bd4t.global.user.id",e.globalUserId)})},{"../../../../static/html/tracking/module/core/common/v7.6.0.js":4,"../../../tracking/utils/adobeDataLayerUtils":2,"../../../tracking/utils/storage":3}],2:[function(e,t,n){function r(e,t,n){var o={};for(var i in t)if(!(Array.isArray(n)&&n.indexOf(i)>=0)&&t.hasOwnProperty(i)&&void 0!==t[i]&&null!==t[i]&&""!==t[i]){var a=t[i];"object"==typeof a?(o[i]={},r(o[i],a,n)):o[i]=a}Object.assign(e,o)}function o(e,t){return Array.isArray(e)?e:void 0!==e&&(Array.isArray(e[t])||Array.isArray(e.all))?(e.all||[]).concat(e[t]||[]):[]}t.exports={dataLayerPushCallback:function(e,t,n){var i=window[e],a={};Array.isArray(t)&&t.forEach(function(e){var t=i[e];Array.isArray(t)?1===t.length?r(a,t[0],o(n,e)):t.length>1&&(a[e]=t):null!==t&&void 0!==t&&r(a,t,o(n,e))}),bd4t("context",a)}}},{}],3:[function(e,t,n){var r=window.localStorage&&"function"==typeof window.localStorage.getItem;if(r)try{window.localStorage.setItem("bd4t.writeTest","true"),window.localStorage.removeItem("bd4t.writeTest")}catch(e){r=!1}t.exports={hasUsableLocalStorage:r}},{}],4:[function(e,t,n){!function(){var t=void 0;!function t(n,r,o){function i(c,s){if(!r[c]){if(!n[c]){var u="function"==typeof e&&e;if(!s&&u)return u(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+c+"'")}var l=r[c]={exports:{}};n[c][0].call(l.exports,function(e){var t=n[c][1][e];return i(t||e)},l,l.exports,t,n,r,o)}return r[c].exports}for(var a="function"==typeof e&&e,c=0;c<o.length;c++)i(o[c]);return i}({1:[function(e,t,n){"use strict";function r(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n])}function o(e){var t=e.indexOf("?");return t>=0&&(e=e.substring(0,t)),e.match(/\.js$/)}function i(e,t,n,i,a){function c(e){r(l,i.createStyles),l.src=e}function s(){p.destroy(),l.parentNode&&l.parentNode.removeChild(l)}var l=n.document.createElement("iframe");l.setAttribute("name",e),r(l,i.createStyles),i.replaceContent&&(t.innerHTML=""),t.appendChild(l);var d=i.url;o(d)?(l.src="about:blank",l.onload=function(){var e=l.contentDocument||l.contentWindow.document,t=e.createElement("script");t.src=d,e.body.appendChild(t)}):l.src=d;var f=e,p=u(n,l.contentWindow,e);p.on("ready",function(){r(l,i.readyStyles)}),p.on("setStyle",function(e){r(l,e)}),a({frame:l,setSrc:c,destroy:s,channelId:f,on:p.on.bind(p),once:p.once.bind(p),when:p.when.bind(p),emit:p.emit.bind(p),get:p.get.bind(p)})}function a(e,t,n,r){var o=e.document.getElementById(t.containerId);if(o)return void n(o);if(r>l+1)throw new Error("Container `"+t.containerId+"` not found after "+l+" tries and "+d+" ms pauses");e[e.__bd4t]("log","info","Container `"+t.containerId+"` not found, trying again in "+d+" ms"),setTimeout(function(){a(e,t,n,r+1)},d)}function c(e,t,n){t=s({createStyles:{border:"0",display:"none",zIndex:9999999},readyStyles:{display:"block"},replaceContent:!0},t);var r=t.containerId||t.id;if(e.document.querySelectorAll('iframe[name="'+r+'"]').length>0)throw new Error("Frame `"+r+"` already exists");t.container?i(r,t.container,e,t,n):setTimeout(function(){a(e,t,function(o){return i(r,o,e,t,n)},1)},0)}var s=e("../lib/merge"),u=e("../lib/messaging"),l=20,d=100;t.exports={createFrame:c}},{"../lib/merge":14,"../lib/messaging":15}],2:[function(e,t,n){"use strict";t.exports=function(){var e={id:"guid",version:"latest"};return e.initialize=function(t){if(null===document.body)throw new Error("Error trying to access document.body");var n={container:document.body,replaceContent:!1,type:"js",url:"https://tracking.bd4travel.com/cdn/".concat(e.id,"-app/").concat(e.version,"/")};t.createFrame(n,function(e){e.forwardFromFrame("config")})},e}},{}],3:[function(e,t,n){"use strict";function r(e,t,n,r){e("ready",t,n,function(e){r.config=i(r.config,e),r.log.debug("Initializing app `"+t+"`: "+JSON.stringify(r.config)),n.initialize(r)})}function o(e,t){var n=e[e.__bd4t];t=t||{};var i=t.id;if(!i)return void n("log","error","[bd4t] [?] App loader is missing app ID");var s="[bd4t] ["+i+"] ";if("string"!=typeof t.version)return void n("log","error",s+"App `"+i+"` has no version");if("function"!=typeof t.initialize)return void n("log","error",s+"App `"+i+"` has no initializer");var u=[];"function"==typeof t.unload&&u.push(t.unload),t.unload=function(){for(var e=0;e<u.length;e++)(0,u[e])()};var l={id:i,version:t.version,bd4t:n,config:t.config||{}};l.createFrame=function(t,r){t=t||{},t.id=t.id||l.id,t.url||(t.url=l.config.url.replace(/-loader\.js$/,"."+(t.type||"html"))),o.createFrame(e,t,function(e){e.forwardFromFrame=function(t){e.on(t,function(){var e=Array.prototype.slice.apply(arguments);e.unshift(t),l.bd4t.apply(n,e)})},e.forwardToFrame=function(t){function n(){var n=Array.prototype.slice.apply(arguments);n.unshift(t),e.emit.apply(e,n)}l.bd4t("on",t,n),u.push(function(){l.bd4t("off",t,n)})},e.forwardFromFrame("log"),e.forwardFromFrame("send"),e.forwardFromFrame("get"),e.forwardFromFrame("initPage"),e.forwardFromFrame("context"),e.forwardToFrame("reply"),e.forwardToFrame("initPage"),e.forwardToFrame("context"),u.push(e.destroy),r(e)})},l.addAutoload=c.addAutoload.bind(c),l.removeAutoload=c.removeAutoload.bind(c),a(l,n,s),r(n,i,t,l)}var i=e("../lib/merge"),a=e("./logging"),c=e("../lib/autoload");o.createFrame=e("./frame").createFrame,t.exports=o},{"../lib/autoload":7,"../lib/merge":14,"./frame":1,"./logging":4}],4:[function(e,t,n){"use strict";t.exports=function(e,t,n){var r=["trace","debug","info","warn","error"];n=n||"",e.log=function(){var e=Array.prototype.slice.apply(arguments);r.indexOf(e[0])<0&&e.unshift("debug"),e[1]=n+e[1],e.unshift("log"),t.apply(t,e)},r.forEach(function(t){e.log[t]=function(){var n=Array.prototype.slice.apply(arguments);n.unshift(t),e.log.apply(e,n)}})}},{}],5:[function(e,t,n){"use strict";var r="undefined"==typeof Promise?e("es6-promise").Promise:Promise,o=e("../../lib/storage").hasUsableLocalStorage,i=e("../../lib/merge"),a=o?localStorage.getItem("bd4t.reco.endpoint"):null,c=o?localStorage.getItem("bd4t.reco.frameJsPath"):null,s=function(e,t,n){return new r(function(r){e.bd4t("get","context",function(o){var c=i({trackingId:e.config.trackingId,userId:e.config.userId,loadedAt:(new Date).getTime(),timings:{reqRecommenderService:(new Date).getTime()},context:o},{context:{url:window.location.href}},n);t.emit("submit",{uri:(a||(e.config.endpoint||"https://api1.bd4travel.com/reco")+"/recommendations")+"?trackingId="+e.config.trackingId,request:c}),t.once("load",r)})})};t.exports=function(e){var t=null,n={};return n.create=function(n){return new r(function(r,o){var u=i({createStyles:{width:"100%",height:"0",display:"inline-block",overflow:"hidden",border:"0",zIndex:9999999,transition:"height 250ms ease"}},n.frameOptions,{containerId:n.containerId,url:(c||(a||"https://api1.bd4travel.com/reco")+"/frame.js")+"?trackingId="+e.config.trackingId}),l=window.performance&&window.performance.timing&&window.performance.timing.navigationStart?{navigationStart:window.performance.timing.navigationStart}:{};u.timings=n.timings||l,u.timings.reqRecoLoader=(new Date).getTime(),e.createFrame(u,function(a){t=a,t.once("frameReady",function(){return s(e,t,n).then(r).catch(o)}),t.on("send",function(t,r){"engagement"===t&&"reco:selection"===r.type&&e.bd4t("emit","recommender:click",{ptoken:r.ptoken,placement:n.placement,containerId:n.containerId,index:r.listPosition,medium:r.medium,element:{id:r.element.id,offerId:r.element.offerId,properties:r.element.properties}})}),t.on("reviews-click",function(t){return e.bd4t("emit","recommender:reviews",i({placement:n.placement,containerId:n.containerId},t))})})})},n.refresh=function(r){if(t){var o=window.document.getElementById(r.containerId);if(o&&o.childElementCount>0)return s(e,t,r);n.destroy()}return n.create(r)},n.destroy=function(){t&&(t.destroy(),t=null)},n}},{"../../lib/merge":14,"../../lib/storage":18,"es6-promise":20}],6:[function(e,t,n){"use strict";var r="undefined"==typeof Promise?e("es6-promise").Promise:Promise,o=e("../../lib/merge"),i=e("./html");t.exports=function(){var e={id:"recommender",version:"2.0.0"},t={},n={},a=null;return e.initialize=function(e){a=e},e.create=function(t){var i=a,c=i.bd4t,s=i.log,u=t.placement,l=t.containerId=t.containerId||u,d=window.performance&&window.performance.timing&&window.performance.timing.navigationStart?{navigationStart:window.performance.timing.navigationStart}:{};t.timings=t.timings||d,t.timings.loaderLoadTime=(new Date).getTime();var f=o({type:"html",version:e.version},t),p=function(e){s.warn("Error initializing recommender:",e.message),c("send","recoinit:error",{placementId:u,containerId:l,error:e.message}),c("emit","recommender:load",{placement:u,containerId:l,success:!1,error:e.message})};try{var g=e.createOrReload(u,l,f);return new r(function(e,t){g.then(e).catch(t),n[l]=window.setTimeout(function(){window.document.getElementById(l)?t(new Error("Timed out after ".concat(17e3," ms"))):s("Give up loading recommender as container ".concat(l," is not available anymore"))},17e3)}).then(function(e){return c("emit","recommender:load",o({placement:u,containerId:l},e))}).catch(p)}catch(e){p(e)}},e.createOrReload=function(e,r,o){var c=a,s=c.bd4t,u=c.log;if(s("send","recoinit",{placementId:e,containerId:r}),t[r]){var l=t[r];return u("Refreshing app instance '".concat(r,"':"),o),n[r]&&(u("Clear timeout for previous instance of ".concat(r)),clearTimeout(n[r])),l.refresh(o)}return u("Creating app instance '".concat(r,"':"),o),(t[r]=i(a)).create(o)},e.destroy=function(e){var n=e.placement,r=e.containerId;if(r=r||n,t[r]){var o=t[r];a.log("Destroying app instance `"+r+"`"),o.destroy(),delete t[r]}},e}},{"../../lib/merge":14,"./html":5,"es6-promise":20}],7:[function(e,t,n){"use strict";function r(e){c&&window.localStorage.setItem(s,JSON.stringify(e))}function o(){if(c){var e=window.localStorage.getItem(s);return e?JSON.parse(e):[]}return[]}function i(e){var t=o();t.indexOf(e)<0&&(t.push(e),r(t))}function a(e){var t=o(),n=t.indexOf(e);n>=0&&(t.splice(n,1),r(t))}var c=e("./storage").hasUsableLocalStorage,s="bd4t.tracker.autoload";t.exports={storageKey:s,getAutoloads:o,addAutoload:i,removeAutoload:a}},{"./storage":18}],8:[function(e,t,n){"use strict";t.exports=function(e,t){return"string"==typeof e?function(){var n=Array.prototype.slice.call(arguments);n.push(e),n.unshift("reply"),t.emit.apply(t,n)}:"function"==typeof e?e:function(){}}},{}],9:[function(e,t,n){"use strict";function r(e){if("localhost"!==e){var t=e.split(".");return t.length>=3&&o.indexOf(t[t.length-2]+"."+t[t.length-1])>-1?(t=t.slice(-3),t.unshift(""),t=t.join(".")):t.length>=2&&(t=t.slice(-2),t.unshift(""),t=t.join(".")),t}}var o=["co.nz","co.uk","com.au","com.br","com.mx"],i=function(e){var t="; "+window.document.cookie,n=t.split("; "+e+"=");return n.length>=2?n.pop().split(";").shift():null},a=function(e,t,n,r){c(e,encodeURIComponent(t),n,r)},c=function(e,t,n,o){o=o||r(window.location.hostname);var i=[e+"="+t];i.push(n),i.push("path=/"),i.push("SameSite=None"),i.push("Secure"),o&&i.push("domain="+o),window.document.cookie=i.join("; ")},s=function(e,t,n,r){c(e,btoa(t),n,r)},u=function(e){var t=r(window.location.hostname),n=[e+"="];n.push("expires=Thu, 01 Jan 1970 00:00:00 GMT"),n.push("max-age=Thu, 01 Jan 1970 00:00:00 GMT"),n.push("path=/"),t&&n.push("domain="+t),window.document.cookie=n.join("; ")},l=function(e){var t=new Date;return t.setTime(t.getTime()+60*e*1e3),"expires="+t.toUTCString()+";max-age="+t.toUTCString()},d=function(e){if(e){var t=decodeURIComponent(e);return 0==t.indexOf("{")?JSON.parse(t):JSON.parse(atob(e))}return null};t.exports={getDomain:r,getCookie:i,setCookie:a,setCookieBase64:s,removeCookie:u,expiresInMinutes:l,cookieDataToJSON:d}},{}],10:[function(e,t,n){"use strict";var r=e("xhr"),o=function(e,t,n,o){var i={uri:"https://api1.bd4travel.com/ab/v2/"+t.trackingId+"/"+t.userId,method:"POST",body:JSON.stringify(n),useXDR:!("withCredentials"in new window.XMLHttpRequest),timeout:5e3};i.useXDR||(i.headers={"Content-Type":"application/json",Accept:"application/json"}),r(i,function(t,n){t?e("error","[bd4t] [tracker] Error getting experiment info: "+n):200!==n.statusCode?e("error","[bd4t] [tracker] Error getting experiment info ("+n.statusCode+"): "+n.body):o(JSON.parse(n.body))})};t.exports={getExperimentInfo:o}},{xhr:27}],11:[function(e,t,n){"use strict";function r(e,t){t=t||{};var n=t.userIdCookieName||a,r=t.userId;return r||(r=i.getCookie(n)),!r&&o&&(r=e.localStorage.getItem(a)),r||(r=function(t){var n=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=n.exec(e.location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}(a)),r||(r=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",t=e.length,n="",r=0;r<12;r++)n+=e[Math.floor(Math.random()*t)];return n+="."+(new Date).getTime()}()),function(t,n,r){i.setCookie(t,n,"expires=Fri, 31 Dec 2037 23:59:59 GMT",r.userIdCookieDomain),o&&e.localStorage.setItem(a,n)}(n,r,t),r}var o=e("./storage").hasUsableLocalStorage,i=e("./cookieUtils"),a="bd4ti";r.getDomain=i.getDomain,t.exports=r},{"./cookieUtils":9,"./storage":18}],12:[function(e,t,n){"use strict";t.exports=function(e,t){var n=e.document.createElement("script");n.defer=!0,n.src=t,e.document.getElementsByTagName("script")[0].parentNode.appendChild(n)}},{}],13:[function(e,t,n){"use strict";function r(e,t){function n(e){u.log("debug","[bd4t] [tracker] Execute command:",e);var t,n=e.shift(),r=n.indexOf(":");if(r>0){var o=n.substring(0,r);n=n.substring(r+1),e.unshift(n),e.unshift(o),t=u.sendToApp}else t=u[n];if("function"!=typeof t)throw new Error("[bd4t] [tracker] Invalid command: `"+n+"`");t.apply(u,e)}var a=e.__bd4t;if(!a||!e[a])throw new Error("The bd4travel tracker was not set up correctly!");var c=e[a];if(e.__bd4t_initialized)return void console.warn("[bd4t] [tracker] The bd4travel tracker was loaded more than once!");if(!e.__bd4t_skipUrlCheck&&o){var s=e.localStorage.getItem("bd4t.tracker.url");if(s)return e.__bd4t_skipUrlCheck=!0,console.info("[bd4t] [tracker] Using URL override: "+s),void r.loadScript(e,s)}var u=i(e,t);u.reqMainTag=e[a].ts,e[a]=function(){n(Array.prototype.slice.call(arguments))},e.__bd4t_initialized=!0,e[a].instance=u;var l=c.q||[],d={init:1,config:2,on:3};l=l.sort(function(e,t){return(d[e[0]]||10)-(d[t[0]]||10)});for(var f=0,p=l.length;f<p;f++)n(Array.prototype.slice.call(l[f]))}var o=e("./storage").hasUsableLocalStorage,i=e("../tracker/index");r.loadScript=e("./loadScript"),t.exports=r},{"../tracker/index":34,"./loadScript":12,"./storage":18}],14:[function(e,t,n){"use strict";var r=e("deepmerge");t.exports=function(){for(var e={},t=0;t<arguments.length;t++)arguments[t]&&(e=r(e,arguments[t]));return e}},{deepmerge:19}],15:[function(e,t,n){"use strict";var r=e("microee");t.exports=function(e,t,n){function o(e){try{if("string"==typeof e.data&&e.data.length&&"{"===e.data[0]){var t=JSON.parse(e.data);if("string"==typeof t.type&&t.channel===n){var r=t.payload||[];r.unshift(t.type),s.emit.apply(s,r)}}}catch(e){}}function i(){var e=Array.prototype.slice.apply(arguments),r=e.shift(),o=a(e),i={type:r,payload:o,channel:n};t.postMessage(JSON.stringify(i),"*")}function a(e){if(e.length&&"function"==typeof e[e.length-1]){var t=e.pop(),n=(new Date).getTime()+"_"+Math.random().toString().substring(2);e.push(n),s.when("reply",function(){var e=Array.prototype.slice.apply(arguments);return e.pop()===n&&(t.apply(null,e),!0)})}return e}function c(){e.removeEventListener("message",o,!1)}if(!n)throw new Error("Channel ID is missing");var s=new r;return e.addEventListener("message",o,!1),{emit:i,on:s.on.bind(s),once:s.once.bind(s),when:s.when.bind(s),removeListener:s.removeListener.bind(s),removeAllListeners:s.removeAllListeners.bind(s),get:i.bind(null,"get"),destroy:c}}},{microee:25}],16:[function(e,t,n){"use strict";t.exports=function(e,t){t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,"");for(var n=t.split("."),r=0,o=n.length-1;r<o;++r){var i=n[r];if(!(i in e))return;e=e[i]}delete e[n[n.length-1]]}},{}],17:[function(e,t,n){"use strict";function r(e){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.exports=function(e,t){if(t=t||{},"object"===r(e))for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}},{}],18:[function(e,t,n){"use strict";var r=window.localStorage&&"function"==typeof window.localStorage.getItem;if(r)try{window.localStorage.setItem("bd4t.writeTest","true"),window.localStorage.removeItem("bd4t.writeTest")}catch(e){r=!1}t.exports={hasUsableLocalStorage:r}},{}],19:[function(e,n,r){!function(e,o){"function"==typeof t&&t.amd?t(o):"object"==typeof r?n.exports=o():e.deepmerge=o()}(this,function(){return function e(t,n){var r=Array.isArray(n),o=r&&[]||{};return r?(t=t||[],o=o.concat(t),n.forEach(function(n,r){void 0===o[r]?o[r]=n:"object"==typeof n?o[r]=e(t[r],n):-1===t.indexOf(n)&&o.push(n)})):(t&&"object"==typeof t&&Object.keys(t).forEach(function(e){o[e]=t[e]}),Object.keys(n).forEach(function(r){"object"==typeof n[r]&&n[r]&&t[r]?o[r]=e(t[r],n[r]):o[r]=n[r]})),o}})},{}],20:[function(e,n,r){(function(o,i){!function(e,o){"object"==typeof r&&void 0!==n?n.exports=o():"function"==typeof t&&t.amd?t(o):e.ES6Promise=o()}(this,function(){"use strict";function t(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function n(e){return"function"==typeof e}function r(e){q=e}function a(e){J=e}function c(){return void 0!==M?function(){M(u)}:s()}function s(){var e=setTimeout;return function(){return e(u,1)}}function u(){for(var e=0;e<F;e+=2)(0,G[e])(G[e+1]),G[e]=void 0,G[e+1]=void 0;F=0}function l(e,t){var n=this,r=new this.constructor(f);void 0===r[W]&&A(r);var o=n._state;if(o){var i=arguments[o-1];J(function(){return _(o,r,i,n._result)})}else x(n,r,e,t);return r}function d(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(f);return b(n,e),n}function f(){}function p(){return new TypeError("You cannot resolve a promise with itself")}function g(){return new TypeError("A promises callback cannot return that same promise.")}function v(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function m(e,t,n){J(function(e){var r=!1,o=v(n,t,function(n){r||(r=!0,t!==n?b(e,n):S(e,n))},function(t){r||(r=!0,k(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,k(e,o))},e)}function h(e,t){t._state===K?S(e,t._result):t._state===Q?k(e,t._result):x(t,void 0,function(t){return b(e,t)},function(t){return k(e,t)})}function y(e,t,r){t.constructor===e.constructor&&r===l&&t.constructor.resolve===d?h(e,t):void 0===r?S(e,t):n(r)?m(e,t,r):S(e,t)}function b(e,n){if(e===n)k(e,p());else if(t(n)){var r=void 0;try{r=n.then}catch(t){return void k(e,t)}y(e,n,r)}else S(e,n)}function w(e){e._onerror&&e._onerror(e._result),I(e)}function S(e,t){e._state===$&&(e._result=t,e._state=K,0!==e._subscribers.length&&J(I,e))}function k(e,t){e._state===$&&(e._state=Q,e._result=t,J(w,e))}function x(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+K]=n,o[i+Q]=r,0===i&&e._state&&J(I,e)}function I(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,a=0;a<t.length;a+=3)r=t[a],o=t[a+n],r?_(n,r,o,i):o(i);e._subscribers.length=0}}function _(e,t,r,o){var i=n(r),a=void 0,c=void 0,s=!0;if(i){try{a=r(o)}catch(e){s=!1,c=e}if(t===a)return void k(t,g())}else a=o;t._state!==$||(i&&s?b(t,a):!1===s?k(t,c):e===K?S(t,a):e===Q&&k(t,a))}function T(e,t){try{t(function(t){b(e,t)},function(t){k(e,t)})}catch(t){k(e,t)}}function E(){return Z++}function A(e){e[W]=Z++,e._state=void 0,e._result=void 0,e._subscribers=[]}function L(){return new Error("Array Methods must be provided an Array")}function C(e){return new ee(this,e).promise}function O(e){var t=this;return new t(P(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function R(e){var t=this,n=new t(f);return k(n,e),n}function D(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function U(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function j(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=te}var N=void 0;N=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var P=N,F=0,M=void 0,q=void 0,J=function(e,t){G[F]=e,G[F+1]=t,2===(F+=2)&&(q?q(u):Y())},X="undefined"!=typeof window?window:void 0,z=X||{},H=z.MutationObserver||z.WebKitMutationObserver,B="undefined"==typeof self&&void 0!==o&&"[object process]"==={}.toString.call(o),V="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,G=new Array(1e3),Y=void 0;Y=B?function(){return function(){return o.nextTick(u)}}():H?function(){var e=0,t=new H(u),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():V?function(){var e=new MessageChannel;return e.port1.onmessage=u,function(){return e.port2.postMessage(0)}}():void 0===X&&"function"==typeof e?function(){try{var e=Function("return this")().require("vertx");return M=e.runOnLoop||e.runOnContext,c()}catch(e){return s()}}():s();var W=Math.random().toString(36).substring(2),$=void 0,K=1,Q=2,Z=0,ee=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(f),this.promise[W]||A(this.promise),P(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&S(this.promise,this._result))):k(this.promise,L())}return e.prototype._enumerate=function(e){for(var t=0;this._state===$&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===d){var o=void 0,i=void 0,a=!1;try{o=e.then}catch(e){a=!0,i=e}if(o===l&&e._state!==$)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===te){var c=new n(f);a?k(c,i):y(c,e,o),this._willSettleAt(c,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===$&&(this._remaining--,e===Q?k(r,n):this._result[t]=n),0===this._remaining&&S(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;x(e,void 0,function(e){return n._settledAt(K,t,e)},function(e){return n._settledAt(Q,t,e)})},e}(),te=function(){function e(t){this[W]=E(),this._result=this._state=void 0,this._subscribers=[],f!==t&&("function"!=typeof t&&D(),this instanceof e?T(this,t):U())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this,r=t.constructor;return n(e)?t.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})}):t.then(e,e)},e}();return te.prototype.then=l,te.all=C,te.race=O,te.resolve=d,te.reject=R,te._setScheduler=r,te._setAsap=a,te._asap=J,te.polyfill=j,te.Promise=te,te})}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{lYpoI2:22}],21:[function(e,t,n){(function(e){var n;n="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},t.exports=n}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],22:[function(e,t,n){function r(){}var o=t.exports={};o.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;(t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)&&n.shift()()},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=r,o.addListener=r,o.once=r,o.off=r,o.removeListener=r,o.removeAllListeners=r,o.emit=r,o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],23:[function(e,t,n){function r(e){var t=o.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}t.exports=r;var o=Object.prototype.toString},{}],24:[function(e,n,r){!function(e,r){"use strict";"function"==typeof t&&t.amd?t(r):"object"==typeof n&&n.exports?n.exports=r():e.log=r()}(this,function(){"use strict";function e(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function t(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function n(n){return"debug"===n&&(n="log"),typeof console!==s&&("trace"===n&&u?t:void 0!==console[n]?e(console,n):void 0!==console.log?e(console,"log"):c)}function r(e,t){for(var n=0;n<l.length;n++){var r=l[n];this[r]=n<e?c:this.methodFactory(r,e,t)}this.log=this.debug}function o(e,t,n){return function(){typeof console!==s&&(r.call(this,t,n),this[e].apply(this,arguments))}}function i(e,t,r){return n(e)||o.apply(this,arguments)}function a(e,t,n){function o(e){var t=(l[e]||"silent").toUpperCase();if(typeof window!==s){try{return void(window.localStorage[d]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(d)+"="+t+";"}catch(e){}}}function a(){var e;if(typeof window!==s){try{e=window.localStorage[d]}catch(e){}if(typeof e===s)try{var t=window.document.cookie,n=t.indexOf(encodeURIComponent(d)+"=");-1!==n&&(e=/^([^;]+)/.exec(t.slice(n))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}var c,u=this,d="loglevel";e&&(d+=":"+e),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=n||i,u.getLevel=function(){return c},u.setLevel=function(t,n){if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=u.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(c=t,!1!==n&&o(t),r.call(u,t,e),typeof console===s&&t<u.levels.SILENT)return"No console available for logging"},u.setDefaultLevel=function(e){a()||u.setLevel(e,!1)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)};var f=a();null==f&&(f=null==t?"WARN":t),u.setLevel(f,!1)}var c=function(){},s="undefined",u=typeof window!==s&&typeof window.navigator!==s&&/Trident\/|MSIE /.test(window.navigator.userAgent),l=["trace","debug","info","warn","error"],d=new a,f={};d.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=f[e];return t||(t=f[e]=new a(e,d.getLevel(),d.methodFactory)),t};var p=typeof window!==s?window.log:void 0;return d.noConflict=function(){return typeof window!==s&&window.log===d&&(window.log=p),d},d.getLoggers=function(){return f},d})},{}],25:[function(e,t,n){function r(){this._events={}}r.prototype={on:function(e,t){this._events||(this._events={});var n=this._events;return(n[e]||(n[e]=[])).push(t),this},removeListener:function(e,t){var n,r=this._events[e]||[];for(n=r.length-1;n>=0&&r[n];n--)r[n]!==t&&r[n].cb!==t||r.splice(n,1)},removeAllListeners:function(e){e?this._events[e]&&(this._events[e]=[]):this._events={}},listeners:function(e){return this._events?this._events[e]||[]:[]},emit:function(e){this._events||(this._events={});var t,n=Array.prototype.slice.call(arguments,1),r=this._events[e]||[];for(t=r.length-1;t>=0&&r[t];t--)r[t].apply(this,n);return this},when:function(e,t){return this.once(e,t,!0)},once:function(e,t,n){function r(){n||this.removeListener(e,r),t.apply(this,arguments)&&n&&this.removeListener(e,r)}return t?(r.cb=t,this.on(e,r),this):this}},r.mixin=function(e){var t,n=r.prototype;for(t in n)n.hasOwnProperty(t)&&(e.prototype[t]=n[t])},t.exports=r},{}],26:[function(e,t,n){var r=function(e){return e.replace(/^\s+|\s+$/g,"")},o=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.exports=function(e){if(!e)return{};for(var t={},n=r(e).split("\n"),i=0;i<n.length;i++){var a=n[i],c=a.indexOf(":"),s=r(a.slice(0,c)).toLowerCase(),u=r(a.slice(c+1));void 0===t[s]?t[s]=u:o(t[s])?t[s].push(u):t[s]=[t[s],u]}return t}},{}],27:[function(e,t,n){"use strict";function r(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function o(e,t,n){var r=e;return l(t)?(n=t,"string"==typeof e&&(r={uri:e})):r=f(t,{uri:e}),r.callback=n,r}function i(e,t,n){return t=o(e,t,n),a(t)}function a(e){function t(){4===l.readyState&&setTimeout(a,0)}function n(){var e=void 0;if(e=l.response?l.response:l.responseText||c(l),w)try{e=JSON.parse(e)}catch(e){}return e}function o(e){return clearTimeout(g),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,u(e,S)}function a(){if(!p){var t;clearTimeout(g),t=e.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var r=S,o=null;return 0!==t?(r={body:n(),statusCode:t,method:m,headers:{},url:v,rawRequest:l},l.getAllResponseHeaders&&(r.headers=d(l.getAllResponseHeaders()))):o=new Error("Internal XMLHttpRequest Error"),u(o,r,r.body)}}if(void 0===e.callback)throw new Error("callback argument missing");var s=!1,u=function(t,n,r){s||(s=!0,e.callback(t,n,r))},l=e.xhr||null;l||(l=e.cors||e.useXDR?new i.XDomainRequest:new i.XMLHttpRequest);var f,p,g,v=l.url=e.uri||e.url,m=l.method=e.method||"GET",h=e.body||e.data,y=l.headers=e.headers||{},b=!!e.sync,w=!1,S={body:void 0,headers:{},statusCode:0,method:m,url:v,rawRequest:l};if("json"in e&&!1!==e.json&&(w=!0,y.accept||y.Accept||(y.Accept="application/json"),"GET"!==m&&"HEAD"!==m&&(y["content-type"]||y["Content-Type"]||(y["Content-Type"]="application/json"),h=JSON.stringify(!0===e.json?h:e.json))),l.onreadystatechange=t,l.onload=a,l.onerror=o,l.onprogress=function(){},l.onabort=function(){p=!0},l.ontimeout=o,l.open(m,v,!b,e.username,e.password),
b||(l.withCredentials=!!e.withCredentials),!b&&e.timeout>0&&(g=setTimeout(function(){if(!p){p=!0,l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",o(e)}},e.timeout)),l.setRequestHeader)for(f in y)y.hasOwnProperty(f)&&l.setRequestHeader(f,y[f]);else if(e.headers&&!r(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(l.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(l),l.send(h||null),l}function c(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}function s(){}var u=e("global/window"),l=e("is-function"),d=e("parse-headers"),f=e("xtend");t.exports=i,t.exports.default=i,i.XMLHttpRequest=u.XMLHttpRequest||s,i.XDomainRequest="withCredentials"in new i.XMLHttpRequest?i.XMLHttpRequest:u.XDomainRequest,function(e,t){for(var n=0;n<e.length;n++)t(e[n])}(["get","put","post","patch","head","delete"],function(e){i["delete"===e?"del":e]=function(t,n,r){return n=o(t,n,r),n.method=e.toUpperCase(),a(n)}})},{"global/window":21,"is-function":23,"parse-headers":26,xtend:28}],28:[function(e,t,n){function r(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var r in n)o.call(n,r)&&(e[r]=n[r])}return e}t.exports=r;var o=Object.prototype.hasOwnProperty},{}],29:[function(e,t,n){"use strict";!function(){var t={trackingEndpoint:"https://tracking.bd4travel.com/collect"};try{e("./lib/loader")(window,t)}catch(t){var n=e("./tracker/log").createLogger();n.error("[bd4t] [tracker] Error initializing the bd4tracker:",t)}}()},{"./lib/loader":13,"./tracker/log":36}],30:[function(e,t,n){"use strict";var r=e("../lib/autoload");t.exports=function(e){e.addAutoload=r.addAutoload}},{"../lib/autoload":7}],31:[function(e,t,n){"use strict";var r=e("../lib/merge"),o=e("../lib/shallow"),i=e("../lib/callback");t.exports=function(e){e.getters={};var t={},n={};e.config=function(n){t=r(t,n),e.emit("config",t)},e.getters.config=function(){return t},e.getters.windowState=function(){return{documentLocation:window.location.href,documentReferrer:window.document.referrer,userAgent:window.navigator.userAgent}},e.initPage=function(t){e.assertInitialized(),e.log("debug","[bd4t] [tracker] Initializing page"),n=t||{},e.emit("initPage",n),e.emit("context",n),e.setExperimentInfo(n)},e.context=function(t){e.assertInitialized(),o(t,n),e.emit("context",n)},e.getters.context=function(){return n},e.get=function(t,n,r){var o=i(n,e),a=t.indexOf(":");if(a>0){var c=t.substring(0,a);return t=t.substring(a+1),void this.sendToApp(c,"get",t,o)}var s=e.getters[t];if(s)o(s());else if(!r)throw new Error("[bd4t] [tracker] Cannot get `"+t+"`")}}},{"../lib/callback":8,"../lib/merge":14,"../lib/shallow":17}],32:[function(e,t,n){"use strict";var r=e("microee");t.exports=function(e){var t=new r;e.off=t.removeListener.bind(t),e.on=t.on.bind(t),e.once=t.once.bind(t),e.when=t.when.bind(t),e.emit=t.emit.bind(t)}},{microee:25}],33:[function(e,t,n){"use strict";var r=e("../lib/cookieUtils"),o=e("../lib/experimentService"),i=e("../lib/merge"),a=e("../lib/storage").hasUsableLocalStorage;t.exports=function(e,t){var n=function(){var e=r.getCookie("bd4tExperimentsData");return e&&r.cookieDataToJSON(e)||{}},c=function(n){if(n.redirects)for(var r in n.redirects)if("/"===r[0]&&r===t.location.pathname){var o=t.location.protocol+"//"+t.location.hostname+n.redirects[r];e.log("debug","[bd4t] [experiments] redirect to "+o),t.document.location=o}if(n.properties&&a){for(var i in localStorage)0===i.indexOf("bd4t.properties.")&&t.localStorage.removeItem(i);for(var c in n.properties)t.localStorage.setItem("bd4t.properties."+c,n.properties[c]);t.bd4Properties=n.properties}},s=function(e){return!(!e.javaScript||!e.javaScript.onSite)&&((0,eval)(e.javaScript.onSite),!0)};e.setExperimentInfo=function(u){if(t.__bd4tExperimentInfoEnabled||a&&t.localStorage.getItem("bd4t.experiments.enabled")){var l=n(),d=!1;if(l){var f=((new Date).getTime()-l.ts)/1e3;if(f<43200&&(c(l),d|=s(l)),l.pauseUpdatesSeconds&&f<l.pauseUpdatesSeconds)return void e.log("debug","[bd4t] [experiments] already updated "+f+" secs ago")}e.get("config",function(t){var n=function(n){o.getExperimentInfo(e.log,t,n,function(t){var n=i(l||{},t);n.ts=(new Date).getTime(),c(n),d||s(n);var o=JSON.stringify(n);e.log("debug","[bd4t] [experiments] setting cookie bd4tExperiments to "+o),r.setCookie("bd4tExperimentsData",o,"expires=Fri, 31 Dec 2037 23:59:59 GMT");var a=JSON.stringify(n.experiments);r.setCookie("bd4tExperiments",a,"expires=Fri, 31 Dec 2037 23:59:59 GMT"),e.emit("experimentSet",a)})};u?n(u):e.get("context",n)})}},e.getters.experimentInfo=n}},{"../lib/cookieUtils":9,"../lib/experimentService":10,"../lib/merge":14,"../lib/storage":18}],34:[function(e,t,n){"use strict";var r=e("../lib/merge"),o=e("../lib/id");t.exports=function(t,n){var i={VERSION:"7.6.0",trackerLoadTime:(new Date).getTime()};t.performance&&t.performance.timing&&t.performance.timing.navigationStart&&(i.navigationStart=t.performance.timing.navigationStart);var a=!1;return i.assertInitialized=function(){if(!a)throw new Error("You must initialize the bd4travel tracker before you can interact with it")},i.init=function(e){if(a)return void i.log("error","[bd4t] [tracker] The bd4travel tracker was already initialized");if("string"!=typeof e||!e)throw new Error("You must initialize the bd4travel tracker with your tracking ID");i.log("info","[bd4t] [tracker] Initializing tracker "+i.VERSION+" for "+e),i.get("config",function(c){n=n||{},t.__bd4tUseCustomerSpecificDns?n.trackingEndpoint="https://api-"+e+".bd4travel.com/collect?"+e:n.trackingEndpoint&&(n.trackingEndpoint+="?"+e);var s={trackingId:e,versions:{tracker:i.VERSION}};i.get("privacy",function(e){!0===t.__bd4tDisablePrivacyCookie?i.removeBd4tPrivacyCookie():e||i.privacy({level:"on",consented:"false"},!0),e&&e.level&&("off"==e.level||"non-personal"==e.level)?(s.userId=null,i.removeBD4TCookie(),i.clearEventHistory()):s.userId=o(t,c);var u=r(n,c,s);i.config(u),a=!0,i.emit("init")})})},e("./autoload")(i,t),e("./data")(i,t),e("./privacy")(i,t),e("./experiments")(i,t),e("./events")(i,t),e("./log")(i,t),e("./load")(i,t),e("./send")(i,t),e("./toolbar")(i,t),i}},{"../lib/id":11,"../lib/merge":14,"./autoload":30,"./data":31,"./events":32,"./experiments":33,"./load":35,"./log":36,"./privacy":37,"./send":38,"./toolbar":39}],35:[function(e,t,n){"use strict";function r(e){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){function n(e,t,n){t=t||{};var r=t.app||e,o=c(g,n.apps),i=c(n,o.default,o[r],t,{id:r});return i.version=i.version||i.defaultVersion,i.url=i.url||f(i),i}function f(e){var t={trackingId:e.trackingId,urlBase:e.urlBase,id:e.id,version:e.version},n=e.urlTemplate;for(var r in t)n=n.replace(new RegExp("{"+r+"}","g"),t[r]);return n}var p=i?localStorage.getItem("bd4t.reco.loaderJsPath"):null,g={default:{urlBase:"https://tracking.bd4travel.com/cdn",urlTemplate:"{urlBase}/{id}/{version}/{id}-loader.js",defaultVersion:"latest"},recommender:{urlBase:"https://reco-cdn.bd4travel.com",urlTemplate:p||"https://api1.bd4travel.com/reco/loader.js"}},v={};e.unload=function(t){var n=v[t];n?(e.log("info","[bd4t] [tracker] Unloading app `"+t+"`"),n.api&&"function"==typeof n.api.unload&&n.api.unload(),delete v[t],e.emit("appUnload",t)):e.log("warn","[bd4t] [tracker] Trying to unload not loaded app `"+t+"`")},e.load=function(i,a){var c=v[i];return c?void e.log("warn","[bd4t] [tracker] App `"+i+"` is already loaded"):(v[i]=c={id:i,requestedAt:(new Date).getTime(),pending:!0},void e.get("config",function(s){c.config=n(i,a,s),e.log("info","[bd4t] [tracker] Loading app `"+i+"`: "+JSON.stringify(c.config)),e.emit("appLoad",c),"recommender"===i?u(t,l()):"guid"===i?u(t,d()):c.config&&"object"===r(c.config.api)?e.ready(i,c.config.api):o.loadScript(t,c.config.url)}))},e.ready=function(t,n,r){var o=v[t];if(!o)return void e.log("warn","[bd4t] [tracker] App `"+t+"` that was not loaded can not report ready");if(!o.pending)return void e.log("warn","[bd4t] [tracker] App `"+t+"` reported ready more than once");if(!n.version)return void e.log("warn","[bd4t] [tracker] App `"+t+"` reported ready without a version");o.readyAt=(new Date).getTime(),o.pending=!1,o.api=n,o.version=n.version;var i={versions:{}};if(i.versions[o.id]=o.version,e.config(i),e.log("debug","[bd4t] [tracker] App `"+o.id+"` version `"+o.version+"` reported ready after "+(o.readyAt-o.requestedAt)+" ms"),e.emit("appReady",o),"function"==typeof r&&r(o.config),o.queue&&o.queue.length){e.log("debug","[bd4t] [tracker] Processing "+o.queue.length+" queued commands for app `"+t+"`");for(var a=0,c=o.queue.length;a<c;a++)o.queue[a](o)}delete o.queue},e.sendToApp=function(){function t(t){"function"==typeof t.api[o]?t.api[o].apply(t.api,n):e.log("warn","[bd4t] [tracker] App `"+r+"` has no method `"+o+"`")}var n=Array.prototype.slice.apply(arguments),r=n.shift(),o=n.shift(),i=e.getPageviewSentTime();n[0]&&n[0].timings&&(n[0].timings.navigationStart=e.navigationStart,n[0].timings.trackerLoadTime=e.trackerLoadTime,n[0].timings.reqMainTag=e.reqMainTag,i&&(n[0].timings.pageviewTime=i));var a=v[r];a||(e.log("debug","[bd4t] [tracker] Implicitly loading app `"+r+"`"),e.load(r),a=v[r]),a.pending?(e.log("debug","[bd4t] [tracker] Queueing command for app `"+r+"`: `"+o+"`"),(a.queue=a.queue||[]).push(t)):t(a)},e.getPageviewSentTime=function(){if(t.localStorage&&"function"==typeof t.localStorage.getItem)return t.localStorage.getItem("tracker.last.pageviewTime")},e.on("init",function(){var n=a.getAutoloads();if(n.length){e.log("debug","[bd4t] [tracker] Automatically starting apps: "+n);for(var r=0,o=n.length;r<o;r++)e.load(n[r]);-1!==n.indexOf("bd4toolbar")?t.toolbarLoaded=!0:e.clearEventHistory()}else e.clearEventHistory()}),e.on("privacy",function(n){n&&("off"!=n.level&&"non-personal"!=n.level||(e.removeBD4TCookie(),e.clearEventHistory(),e.get("config",function(t){var n=c(t,{userId:null});e.config(n)})),"on"==n.level&&e.get("config",function(n){var r=s(t,n),o=c(n,{userId:r});e.config(o)}),e.sendPrivacyUpdate(n))})}var i=e("../lib/storage").hasUsableLocalStorage,a=e("../lib/autoload"),c=e("../lib/merge"),s=e("../lib/id"),u=e("../app/loader"),l=e("../app/recommender/recommender"),d=e("../app/guid/guid");o.loadScript=e("../lib/loadScript"),t.exports=o},{"../app/guid/guid":2,"../app/loader":3,"../app/recommender/recommender":6,"../lib/autoload":7,"../lib/id":11,"../lib/loadScript":12,"../lib/merge":14,"../lib/storage":18}],36:[function(e,t,n){"use strict";function r(){var e=i.loglevel.getLogger("bd4t");return o(e,a&&window.localStorage.getItem("bd4t.tracker.loglevel")||c),e}function o(e,t){e.setLevel(e.levels[t],!1),a&&window.localStorage.setItem("bd4t.tracker.loglevel",t)}function i(e){function t(e){e in n.levels&&i!==e&&(i=e,o(n,e))}var n=r(),i=null;e.log=function(){var t=Array.prototype.slice.apply(arguments),r=t.shift();"function"!=typeof n[r]&&(n.error("[bd4t] [tracker] Invalid log level: "+r),r="debug"),n[r].apply(n,t),e.emit("log",r,t)},e.on("config",function(e){e.loglevel?t(e.loglevel):"debug"in e&&t(!0===e.debug?s:c)})}var a=e("../lib/storage").hasUsableLocalStorage,c="SILENT",s="TRACE";i.loglevel=e("loglevel"),i.createLogger=r,t.exports=i},{"../lib/storage":18,loglevel:24}],37:[function(e,t,n){"use strict";var r=e("../lib/merge"),o=e("../lib/cookieUtils");t.exports=function(e){e.removeBD4TCookie=function(){o.getDomain(window.location.hostname),e.get("config",function(e){var t=e.userIdCookieName||"bd4ti";o.removeCookie(t)})},e.removeBd4tPrivacyCookie=function(){o.removeCookie("bd4tPrivacy")},e.privacy=function(t,n){n=void 0!==n&&n,e.get("privacy",function(i){var a=r(i,t);n||(a=r(a,{consented:"true"}),e.emit("privacy",a)),o.setCookie("bd4tPrivacy",JSON.stringify(a),"expires=Fri, 31 Dec 2037 23:59:59 GMT")})},e.getters.privacy=function(){var e=o.getCookie("bd4tPrivacy");return o.cookieDataToJSON(e)}}},{"../lib/cookieUtils":9,"../lib/merge":14}],38:[function(e,t,n){"use strict";function r(e){for(var t=p[e.action]||[],n=0,r=t.length;n<r;++n)s(e,t[n]);if("pageview"===e.action){t=g[e.type]||[];for(var o=0,i=t.length;o<i;++o)s(e,t[o])}}function o(e,t){function n(){if(a){var e=JSON.parse(t.localStorage.getItem(f)||"[]");if(e instanceof Array)return e}return[]}function s(r){a&&t.toolbarLoaded&&e.get("privacy",function(e){if(!e||!e.level||"off"!==e.level&&"non-personal"!==e.level){var i=n();i.unshift(r),i.length>o.historyMaxLength&&i.pop(),t.localStorage.setItem(f,JSON.stringify(i))}})}function p(n,r,o){e.log("debug","[bd4t] [tracker] Sending event: "+n.action);var a={uri:r.trackingEndpoint,method:"POST",body:"ed="+encodeURIComponent(JSON.stringify(n)),useXDR:!("withCredentials"in new t.XMLHttpRequest)};a.useXDR||(a.headers={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}),i(a,function(t,r){t?e.log("error","[bd4t] [tracker] Error sending event: "+r):200!==r.statusCode?e.log("error","[bd4t] [tracker] Error sending tracking event ("+r.statusCode+"): "+r.body):(s(n),e.emit("send",n),"function"==typeof o&&o(n))})}function g(){a&&t.localStorage.setItem("tracker.last.pageviewTime",(new Date).getTime())}e.send=function(n,o,i){var c=new Date;e.assertInitialized(),"function"==typeof o&&(i=o,o=void 0),"pageview"===n&&g();var s=null;a&&(s=t.localStorage.getItem("bd4t.global.user.id")),e.get("config",function(a){e.get("context",function(f){e.get("privacy",function(g){var v=JSON.parse(JSON.stringify(o||{})),m=JSON.parse(JSON.stringify(f));return v.context=m,v.version=u,v.subversion=l,v.timestamp=c.toISOString(),v.trackingId=a.trackingId,v.userId=a.userId,v.globalUserId=s||a.globalUserId,v.action=n,v.documentLocation=t.location.href,v.documentReferrer=t.document.referrer,v.userAgent=t.navigator.userAgent,v.versions={bd4tracker:e.VERSION},v.privacySetting=g,v.trackingRegion=d,r(v),g&&g.level&&"off"==g.level?(e.log("info","[bd4t] [tracker] Error sending event: tracking has been disabled due to privacy settings"),void("function"==typeof i&&i(v))):void p(v,a,i)})})})},e.getters.eventHistory=n,e.clearEventHistory=function(n){a&&t.localStorage.setItem(f,"[]"),c(n,e)()},e.sendPrivacyUpdate=function(n,r){var o=new Date;e.assertInitialized(),e.get("config",function(i){var a={};a.context={},a.context.type="privacy",a.privacySetting=n,a.version=u,a.subversion=l,a.timestamp=o.toISOString(),a.trackingId=i.trackingId,a.userId=i.userId,a.action="pageview",a.documentLocation=t.location.href,a.documentReferrer=t.document.referrer,a.userAgent=t.navigator.userAgent,a.versions={bd4tracker:e.VERSION},a.trackingRegion=d,p(a,i,r)})}}var i=e("xhr"),a=e("../lib/storage").hasUsableLocalStorage,c=e("../lib/callback"),s=e("../lib/removeProperty"),u=(e("../lib/shallow"),window.__bd4tVersionOverride||5),l=window.__bd4tSubVersionOverride||2,d=window.__bd4tSatelliteRegion||"innovo",f="bd4t.tracker.history",p={recoview:["context.productList.elements","context.offerList.elements"]},g={productDetails:["context.productList"]};o.historyMaxLength=20,t.exports=o},{"../lib/callback":8,"../lib/removeProperty":16,"../lib/shallow":17,"../lib/storage":18,xhr:27}],39:[function(e,t,n){"use strict";var r=e("../lib/autoload");t.exports=function(e){e.on("init",function(){window.location.href.indexOf("bd4toolbar")>0&&(r.addAutoload("bd4toolbar"),e.load("bd4toolbar"))})}},{"../lib/autoload":7}]},{},[29])}()},{}]},{},[1])}();